<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>SoongsilBERT-BEEP!</title>
        <link rel="icon" type="image/x-icon" href="{{url_for('static', filename='assets/favicon.ico')}}"/>
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <!-- <link rel="stylesheet" href='css/style.css'> -->
        <link href="{{url_for('static', filename='css/styles.css')}}" rel="stylesheet" />
    </head>
    <script type="text/javascript">
        let time_obj = undefined;
        let flag = undefined;
        let chars = undefined;
    
        window.onload = () => {
            time_obj = document.getElementById("timer");
            flag = false;       // 더블 클릭 체크
        }
    
    
        function double_submit_check() {
            if (flag) {
                console.log("double");
                return true;
            }
            else {
                flag = true;
    
                return false;
            }
        }
    
    
        function send_req() {
            if (double_submit_check()){
                return ;
            }
    
            let text = document.getElementById("text").value;
            // let category = document.getElementById("category").value;
            // let length = document.getElementById("length").value;
            let types_radio = document.getElementsByName("types");
            let types = 'dpclass';
    
            if (text == '') {
                document.getElementById('warning').innerText = 'Please fill text!';
                flag = false;
                return ;
            }
    
            for (var i=0; i<types_radio.length; i++) {
                if (types_radio[i].checked == true) {
                    types = types_radio[i].value;
                }
            }
    
            const formData = new FormData();
            const url = `/predict/${types}`;
            let start = 0;
    
            formData.append('text', text);
            // formData.append('category', category);
    
            // timer
            timer = setInterval(() => {
                start += 1;
                time_obj.innerText = `${start / 10} 's`;
            }, 100);
    
    
            fetch (url, { method: 'POST', body: formData, })
            .then(response => {
                if (response.status === 200) {
                    return response.json();
                } else {
                    clearInterval(timer);
                    flag = false;
                }
            }).catch(err => {
                clearInterval(timer);
                flag = false;
                document.getElementById('warning').innerText = err;
            }).then(data => {
                const result = document.getElementById('result');
                result.innerHTML = '&nbsp;&nbsp;' + data[0];
    
                clearInterval(timer);
                time_obj.innerText = 'Done!';
                flag = false;
            }).catch(err => {
                clearInterval(timer);
                flag = false;
                document.getElementById('warning').innerText = err;
            });
    
        }
    
    </script>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
            <div class="container">
                <a class="navbar-brand" href="#!">SoongsilBERT-BEEP!</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item"><a class="nav-link" href="https://huggingface.co/jason9693/SoongsilBERT-beep-base">Huggingface</a></li>
                        <li class="nav-item"><a class="nav-link" href="#!">Paper(To Be Cont.)</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <header class="masthead text-center text-white">
            <div class="masthead-content">
                <div class="container">
                    <h1 class="masthead-heading mb-0">SoongsilBERT:BEEP!</h1>
                    <h2 class="masthead-subheading mb-0">Hate Speech Classifier</h2>
                    <a class="btn btn-primary btn-xl rounded-pill mt-5" href="https://github.com/jason9693/SoongsilBERT-base-beep-deploy">Github repository</a>
                </div>
            </div>
            <div class="bg-circle-1 bg-circle"></div>
            <div class="bg-circle-2 bg-circle"></div>
            <div class="bg-circle-3 bg-circle"></div>
            <div class="bg-circle-4 bg-circle"></div>
        </header>
        <section>
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 order-lg-2">
                        <div class="p-5">
                            <img class="img-fluid rounded-circle" src="{{url_for('static', filename='assets/img/03.jpg')}}" alt="..." />
                        </div>
                    </div>
                    <div class="col-lg-6 order-lg-1">
                        <div class="p-5">
                            <h2 class="display-4">SoongsilBERT</h2>
                            <p>SoongsilBERT(KcBERTv2)는 대학 커뮤니티 특성에 맞는 데이터셋에 적용하기 위해, 
                                KcBERT의 데이터에 더해 대학 커뮤니티, 대학 공지사항 등의 데이터를 추가하여 처음부터 학습한 RoBERTa모델 기반의 Pretrained BERT 모델입니다.<br>
                                아래 데모는 SoongsilBERT모델로 학습한 beep 데이터 기반의 Hate Speech 모델을 테스트 해보는 데모사이트 입니다.
                                <b>일반/공격성/차별발언</b> 분류모델을 확인해 보세요</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <hr width="100%">
        <section>
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 order-lg-2">
                        <div class="generate">
                            <div class="form-group">
                                <h3>문장 입력하기</h3>
                                <label class="btn-group-toggle"> Type:
                                    <input type="radio" name="types" value="dplogits"> 확률로 보기
                                    <input type="radio" name="types" value="dpclass" checked> 결과로 보기
                                </label><br>
                                <textarea rows="4" class="form-control" id="text" name="text" inputmode="true" placeholder="예측하기 버튼을 누르면 입력하신 텍스트에 대한 결과가 아래에 출력됩니다."></textarea>
                                
                                        <!--style="font-family: 'Nanum Gothic';" name="text" class="form-control" id="formGroupExampleInput" placeholder="텍스트를 입력하세요."/>-->
                              </div>
                            <button class="btn btn-primary btn=lg" type="submit" id="button1" onclick="send_req();">Submit</button><br>
                            <b><label id="warning" style="color:red;"></label></b>
                        </div>
                        <br><hr width="100%">
                        <div>
                            <div class="result">
                                <h3><label>결과확인</label></h3>
                                <!-- Story generate result table -->
                                <h3 class="display-4"><label id="result"></label></h3>
                                <br>
                                <label>Inference Time:&nbsp;</label><label id="timer">0.0</label><br>
                            </div>
                        </div>
                    </div>
                    
                    
                </div>
            </div>
            
        </section>
        <!-- <section>
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <div class="p-5"><img class="img-fluid rounded-circle" src="assets/img/02.jpg" alt="..." /></div>
                    </div>
                    <div class="col-lg-6">
                        <div class="p-5">
                            <h2 class="display-4">We salute you!</h2>
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod aliquid, mollitia odio veniam sit iste esse assumenda amet aperiam exercitationem, ea animi blanditiis recusandae! Ratione voluptatum molestiae adipisci, beatae obcaecati.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section> -->

        <!-- Footer-->
        <footer class="py-5 bg-black">
            <div class="container"><p class="m-0 text-center text-white small">Copyright &copy; Your Website 2021</p></div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <!-- <script src="{{url_for('static', filename='js/script.js')}}"></script> -->
    </body>
</html>
